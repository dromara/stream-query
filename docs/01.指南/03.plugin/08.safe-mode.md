---
title: safe-mode
date: 2023-07-06 09:37:10
author: Cason
permalink: /pages/b009d5/
---

## 全局安全模式
> 开启后可以检测租户插件和`LambdaQueryWrapper 使用中可能出现的`sql注入`
> [关于MybatisPlus使用的安全漏洞说明](https://baomidou.com/pages/110sec/)

### 配置
在`application.yml`引入`safe-mode`配置项，`on`为开启，`off`为关闭
```yml
stream-query:  
  mybatis-plus:  
    safe-mode: on
```

### 租户插件
为了防止`租户id`可能引发的`sql注入`问题，在开启`safe-mode`后，请使用`SqTenantLineInnerInterceptor`替换`MybatisPlus`的租户插件。

报错提示如下：
```
SQL Injection attempt detected in 'TenantLineInnerInterceptor
```

### LambdaQueryWrapper
请在开启`safe-mode`后，使用`QueryCondition`来取代原先的`LambdaQueryWrapper`，条件拼接方法是一样的。`QueryCondition`同时还支持`TypeHandler`。具体使用[QueryCondition]()

报错提示如下
```
SQL Injection attempt detected in 'apply'
```

## 测试用例地址
>[safe-mode-wrapper](https://gitee.com/dromara/stream-query/blob/main/stream-plugin/stream-plugin-mybatis-plus/src/test/java/org/dromara/streamquery/stream/plugin/mybatisplus/safe/SqlInjectionWrapperTest.java)
>[safe-mode-Tenant](https://gitee.com/dromara/stream-query/blob/main/stream-plugin/stream-plugin-mybatis-plus/src/test/java/org/dromara/streamquery/stream/plugin/mybatisplus/safe/SqlInjectionTenantTest.java)